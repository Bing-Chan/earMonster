(function(e,d){typeof exports=="object"&&typeof module!="undefined"?module.exports=d(require("vue")):typeof define=="function"&&define.amd?define(["vue"],d):(e=typeof globalThis!="undefined"?globalThis:e||self,e.sign=d(e.Vue))})(this,function(e){"use strict";const d={class:"esign-wrapper"},b=["width","height"],q={className:"sign-btnWrap"};var u=e.defineComponent({__name:"sign",props:{width:{type:Number,required:!1,default:400},height:{type:Number,required:!1,default:200},lineWidth:{type:Number,required:!1,default:4},strokeColor:{type:String,required:!1,default:"green"},lineCap:{type:String,required:!1,default:"round"},lineJoin:{type:String,required:!1,default:"round"},bgColor:{type:String,required:!1,default:"transparent"},showBtn:{type:Boolean,required:!1,default:!0},onSave:{type:Function,required:!1},onClear:{type:Function,required:!1},onDrawEnd:{type:Function,required:!1}},setup(p){const k=p,{width:s,height:c,lineWidth:S,strokeColor:N,lineCap:B,lineJoin:X,bgColor:Y,showBtn:L,onSave:h,onClear:m,onDrawEnd:w}=k,o=e.ref(null),n=e.ref(null),r=e.ref({offsetX:0,offsetY:0,endX:0,endY:0}),l=/Mobile|Android|iPhone/i.test(navigator.userAgent),x=()=>{o.value&&(o.value.getContext("2d").clearRect(0,0,s,c),m&&m(o.value))},R=()=>{o.value.toBlob(t=>{const i=Date.now().toString(),a=document.createElement("a");a.download=`${i}.png`,a.href=URL.createObjectURL(t),a.click(),a.remove(),h&&h(t)})},y=t=>{const{pageX:i,pageY:a}=l?t.changedTouches[0]:t,f=o.value,{x:v,y:g}=f.getBoundingClientRect();r.value.endX=i,r.value.endY=a,n.value.lineTo(i-v,a-g),n.value.stroke()},C=t=>{const{offsetX:i,offsetY:a,pageX:f,pageY:v}=l?t.changedTouches[0]:t,g=o.value,{x:F,y:W}=g.getBoundingClientRect();r.value.offsetX=i,r.value.offsetY=a,r.value.endX=f,r.value.endY=v,n.value.beginPath(),n.value.lineWidth=S,n.value.strokeStyle=N,n.value.lineCap=B,n.value.lineJoin=X,n.value.moveTo(r.value.endX-F,r.value.endY-W),window.addEventListener(l?"touchmove":"mousemove",y)},E=()=>{console.log(n.value),n.value.closePath(),window.removeEventListener("mousemove",y),w&&w(o.current)},_=()=>{const t=o.value;t.width=s,t.height=c;const i=t.getContext("2d");n.value=i,n.value.fillStyle=Y,n.value.fillRect(0,0,s,c)},D=()=>{window.addEventListener(l?"touchstart":"mousedown",C),window.addEventListener(l?"touchend":"mouseup",E)},T=()=>{window.removeEventListener(l?"touchstart":"mousedown",C),window.removeEventListener(l?"touchend":"mouseup",E)},V=()=>{_(),D()};return e.onMounted(()=>{V()}),e.onUnmounted(()=>{T()}),(t,i)=>(e.openBlock(),e.createElementBlock("div",d,[e.createElementVNode("canvas",{ref_key:"canvasRef",ref:o,width:e.unref(s),height:e.unref(c),style:{border:"1px solid #ccc"}},null,8,b),e.withDirectives(e.createElementVNode("div",q,[e.createElementVNode("span",{onClick:x,className:"sign-btn"},"\u6E05\u9664"),e.createElementVNode("span",{onClick:R,className:"sign-btn primary"},"\u4FDD\u5B58")],512),[[e.vShow,e.unref(L)]])]))}});return u.__scopeId="data-v-0772085a",u.__file="packages/components/sign/sign.vue",u.install=p=>{p.component("GaSign",u)},u});
