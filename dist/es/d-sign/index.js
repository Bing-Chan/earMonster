import{defineComponent as A,ref as h,onMounted as J,onUnmounted as M,openBlock as P,createElementBlock as U,createElementVNode as s,unref as f,withDirectives as j,vShow as V}from"vue";const G={class:"esign-wrapper"},I=["width","height"],O={className:"sign-btnWrap"};var u=A({__name:"sign",props:{width:{type:Number,required:!1,default:400},height:{type:Number,required:!1,default:200},lineWidth:{type:Number,required:!1,default:4},strokeColor:{type:String,required:!1,default:"green"},lineCap:{type:String,required:!1,default:"round"},lineJoin:{type:String,required:!1,default:"round"},bgColor:{type:String,required:!1,default:"transparent"},showBtn:{type:Boolean,required:!1,default:!0},onSave:{type:Function,required:!1},onClear:{type:Function,required:!1},onDrawEnd:{type:Function,required:!1}},setup(v){const k=v,{width:r,height:d,lineWidth:q,strokeColor:S,lineCap:B,lineJoin:X,bgColor:Y,showBtn:L,onSave:m,onClear:w,onDrawEnd:y}=k,t=h(null),e=h(null),i=h({offsetX:0,offsetY:0,endX:0,endY:0}),l=/Mobile|Android|iPhone/i.test(navigator.userAgent),N=()=>{t.value&&(t.value.getContext("2d").clearRect(0,0,r,d),w&&w(t.value))},R=()=>{t.value.toBlob(n=>{const o=Date.now().toString(),a=document.createElement("a");a.download=`${o}.png`,a.href=URL.createObjectURL(n),a.click(),a.remove(),m&&m(n)})},C=n=>{const{pageX:o,pageY:a}=l?n.changedTouches[0]:n,c=t.value,{x:p,y:g}=c.getBoundingClientRect();i.value.endX=o,i.value.endY=a,e.value.lineTo(o-p,a-g),e.value.stroke()},b=n=>{const{offsetX:o,offsetY:a,pageX:c,pageY:p}=l?n.changedTouches[0]:n,g=t.value,{x:F,y:W}=g.getBoundingClientRect();i.value.offsetX=o,i.value.offsetY=a,i.value.endX=c,i.value.endY=p,e.value.beginPath(),e.value.lineWidth=q,e.value.strokeStyle=S,e.value.lineCap=B,e.value.lineJoin=X,e.value.moveTo(i.value.endX-F,i.value.endY-W),window.addEventListener(l?"touchmove":"mousemove",C)},E=()=>{console.log(e.value),e.value.closePath(),window.removeEventListener("mousemove",C),y&&y(t.current)},_=()=>{const n=t.value;n.width=r,n.height=d;const o=n.getContext("2d");e.value=o,e.value.fillStyle=Y,e.value.fillRect(0,0,r,d)},x=()=>{window.addEventListener(l?"touchstart":"mousedown",b),window.addEventListener(l?"touchend":"mouseup",E)},D=()=>{window.removeEventListener(l?"touchstart":"mousedown",b),window.removeEventListener(l?"touchend":"mouseup",E)},T=()=>{_(),x()};return J(()=>{T()}),M(()=>{D()}),(n,o)=>(P(),U("div",G,[s("canvas",{ref_key:"canvasRef",ref:t,width:f(r),height:f(d),style:{border:"1px solid #ccc"}},null,8,I),j(s("div",O,[s("span",{onClick:N,className:"sign-btn"},"\u6E05\u9664"),s("span",{onClick:R,className:"sign-btn primary"},"\u4FDD\u5B58")],512),[[V,f(L)]])]))}});u.__scopeId="data-v-0772085a",u.__file="packages/components/sign/sign.vue",u.install=v=>{v.component("GaSign",u)};export{u as default};
